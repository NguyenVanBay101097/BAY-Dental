<div class="o_cp_controller">
    <div class="o_control_panel">
        <ol class="breadcrumb">
            <li class="active">Kênh xã hội Facebook</li>
        </ol>
        <div class="o_cp_searchview">
            <div class="o_cp_searchview_group">
                <div class="o_searchview">
                    <input class="o_searchview_input" placeholder="Tìm kiếm theo tên.." type="text">
                </div>
            </div>
        </div>
        <div class="o_cp_left">
            <div class="o_cp_buttons">
                <div class="o_form_buttons_view">
                    <button *ngIf="!logged_in" type="button" class="btn btn-primary btn-sm" accesskey="c"
                        (click)="login()">
                        Đăng nhập Facebook
                    </button>
                    <button *ngIf="logged_in" type="button" class="btn btn-primary btn-sm" accesskey="c"
                        (click)="logout()">
                        Đăng xuất Facebook
                    </button>
                    <button *ngIf="logged_in && !selectedPage" type="button" class="btn btn-primary btn-sm"
                        accesskey="c" (click)="showModalAddConnect()">
                        Thêm kết nối
                    </button>
                    <button *ngIf="selectedPage" type="button" class="btn btn-light btn-sm" accesskey="c"
                        (click)="selectPage(null)">
                        Quay lại Danh sách Trang kết nối
                    </button>
                </div>
            </div>
        </div>
        <div class="o_cp_right">

        </div>
    </div>
</div>

<div class="pages card pages_connected" *ngIf="logged_in && !selectedPage">
    <b class="mid">Danh sách trang đang kết nối</b>
    <div class="card mid" *ngFor="let item of DataFanpagesConnected; let i = index" (click)="selectPage(item)">
        <table>
            <tr>
                <td width=1%>
                    <img src="{{item.picture}}" alt="">
                </td>
                <td style="text-align: left;">
                    <b>{{item.name}}</b>
                </td>
                <td width="1%">
                    <button type="button" class="btn btn-light"
                        style="white-space: nowrap; margin-right: 10px;">Gỡ kết nối</button>
                </td>
            </tr>
        </table>
    </div>
</div>

<div class="pages conversations" *ngIf="selectedPage">
    <table>
        <tr>
            <td>
                <div class="card list_Customers">
                    <div class="mid tag" *ngFor="let item of DataCustomers; let i = index"
                        [class.selected]="item === selectedCustomer" (click)="selectCustomer(item)">
                        <table>
                            <tr>
                                <td>
                                    <img class="avatar"
                                        src="{{item.picture}}" alt="">
                                </td>
                                <td>
                                    <b>{{item.name}}</b><br>
                                    <span [class.font-weight-bold]="item.unread_count" style="font-size: 0.9rem;">
                                        <span *ngIf="item.message_from_page">Bạn:</span>
                                        {{item.snippet}}
                                    </span>
                                </td>
                                <td>
                                    <span style="font-size: 0.9rem;">{{item.updated_time}}</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </td>
            <td *ngIf="!selectedCustomer">
                <div class="card">
                    <h2 class="mid" style="margin-top: 20%;">Chào mừng bạn đến với<b> Kênh Facebook</b></h2>
                    <p class="mid">Chọn hội thoại từ danh sách để bắt đầu</p>
                    <div class="mid card">
                        <table>
                            <tr>
                                <td width=1%>
                                    <img class="avatar"
                                        src="{{selectedPage.picture}}" alt="">
                                </td>
                                <td style="text-align: left;">
                                    <b style="margin-left: 10px; margin-right: 10px;">{{selectedPage.name}}</b>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </td>
            <td *ngIf="selectedCustomer && loading">
                <div class="card">
                    <h2 class="mid" style="margin-top: 20%;">Loading..</h2>
                </div>
            </td>
            <td *ngIf="selectedCustomer && !loading">
                <div class="card message">
                    <div class="message_box" id="message_box">
                        <div *ngFor="let DataGroupMessagesCustomer of DataMessagesCustomer" class="message_group">
                            <div class="message_date">{{DataGroupMessagesCustomer[0].created_time}}</div>
                            <div *ngFor="let item of DataGroupMessagesCustomer" class="message_con" [class.my_message]="item.message_from_page">
                                <img *ngIf="!item.message_from_page && item.last_message" class="avatar_message" src="{{selectedCustomer.picture}}" alt="">
                                <span class="message_content" [class.margin-left_message_content]="!item.message_from_page && !item.last_message"
                                    [class.first_message]="item.first_message" [class.last_message]="item.last_message">
                                    {{item.message}}
                                </span> 
                            </div>
                        </div>
                    </div>
                    <div class="message_input">
                        <table style="width: 100%; height: 100%;">
                            <tr>
                                <td style="width: 1%; white-space: nowrap;">
                                    <i class="fas fa-plus-circle"></i>
                                    <i class="fas fa-images"></i>
                                    <i class="fas fa-file"></i>
                                </td>
                                <td>
                                    <input type="text" name="" id="" placeholder="Nhập tin nhắn...">
                                </td>
                                <td width=1%>
                                    <i class="fas fa-heart"></i>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </td>
            <td *ngIf="selectedCustomer && !loading">
                <div class="card detail_Customer">
                    <img class="mid avatar" src="{{selectedCustomer.picture}}" alt="">
                    <table class="mid">
                        <tr>
                            <td>
                                <b *ngIf="linkedPartner">{{selectedPartner.partnerName}}</b>
                                <b *ngIf="!selectCustomer.editing_name && !linkedPartner">{{selectedCustomer.name}}</b>
                                <input *ngIf="selectCustomer.editing_name" type="text" name="" id="" [(ngModel)]="selectedCustomer.name">
                            </td>
                            <!-- <td>
                                <button *ngIf="!selectCustomer.editing_name" type="button" class="btn btn-light myBtnEdit"
                                    (click)="selectCustomer.editing_name = true"><i class="fas fa-pencil-alt"></i></button>
                                <button *ngIf="selectCustomer.editing_name" type="button" class="btn btn-light myBtnEdit"
                                    (click)="selectCustomer.editing_name = false"><i class="fas fa-times"></i></button>
                            </td> -->
                        </tr>
                    </table>
                    <table class="mid">
                        <tr>
                            <td>
                                <span *ngIf="linkedPartner">{{selectedPartner.partnerPhone}}</span>
                                <span *ngIf="!selectCustomer.editing_phone && !linkedPartner">{{selectedCustomer.phone ? selectedCustomer.phone : 'Chưa có số điện thoại'}}</span>
                                <input *ngIf="selectCustomer.editing_phone" type="number" name="" id="" placeholder="Chưa có số điện thoại"
                                    [(ngModel)]="selectedCustomer.phone">
                            </td>
                            <!-- <td>
                                <button *ngIf="!selectCustomer.editing_phone" type="button" class="btn btn-light myBtnEdit"
                                    (click)="selectCustomer.editing_phone = true"><i class="fas fa-pencil-alt"></i></button>
                                <button *ngIf="selectCustomer.editing_phone" type="button" class="btn btn-light myBtnEdit"
                                    (click)="selectCustomer.editing_phone = false"><i class="fas fa-times"></i></button>
                            </td> -->
                        </tr>
                    </table>
                    <div class="row mid" style="width: 100%;">
                        <kendo-combobox
                            *ngIf="!linkedPartner"
                            name="selectedPartner"
                            [data]="listPartners"
                            [textField]="'partnerName'"
                            [valueField]="'partnerId'"
                            [placeholder]="'Tên hoặc sđt'"
                            [(ngModel)]="selectedPartner"
                            style="padding: 0; width: calc(100% - 40px - 5px); margin-right: 5px;"
                        >
                            <ng-template kendoComboBoxItemTemplate let-dataItem>
                                <table>
                                    <tr>
                                        <td><b>{{ dataItem.partnerName }}</b></td>
                                    </tr>
                                    <tr>
                                        <td>{{ dataItem.partnerPhone }}</td>
                                    </tr>
                                </table>
                            </ng-template>
                        </kendo-combobox>
                        <button *ngIf="!linkedPartner" type="button" class="btn btn-light border" accesskey="c" (click)="showModalCreatePartner()">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div> 
                    <button *ngIf="!linkedPartner" type="button" class="btn btn-light border" accesskey="c" (click)="onMapPartner()">Liên kết</button>
                    <button *ngIf="linkedPartner" type="button" class="btn btn-light border" accesskey="c" (click)="onUnlinkPartner()">Hủy liên kết</button>
                </div>
            </td>
        </tr>
    </table>
</div>