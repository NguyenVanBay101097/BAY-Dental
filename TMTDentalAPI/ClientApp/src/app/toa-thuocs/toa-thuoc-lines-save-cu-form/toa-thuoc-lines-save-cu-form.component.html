<button type="button" class="btn btn-primary btn-sm" (click)="onCreate()">Thêm thuốc</button>

<table class="table table-sm mt-2" [formGroup]="thuocsForm">
    <thead>
        <tr>
            <th>Tên thuốc</th>
            <th>Số lần/ ngày</th>
            <th>Số lượng/ lần</th>
            <th>Tổng</th>
            <th>Đơn vị</th>
            <th>Số ngày</th>
            <th>Hướng dẫn sử dụng</th>
            <th>#</th>
        </tr>
    </thead>
    <tbody formArrayName="thuocArray"
        *ngFor="let item of getThuocArray.controls; let i = index;">
        <tr [formGroupName]="i" *ngIf="getValueThuocArray(i, 'openInput')">
            <td>
                <kendo-combobox [data]="filteredProducts" [textField]="'name'" [filterable]="true" #productCbx
                    formControlName="product" [valueField]="'id'">
                </kendo-combobox>
                <div *ngIf="getControlsThuocArray(i).product.errors && 
                    (getControlsThuocArray(i).product.touched || getControlsThuocArray(i).product.dirty || getValueThuocArray(i, 'submitted'))" class="text-danger">
                    <div *ngIf="getControlsThuocArray(i).product.errors.required">Nhập tên thuốc</div>
                </div>
            </td>
            <td>
                <kendo-numerictextbox class="max-w-numberric"
                    [min]="0" [format]="'n0'" formControlName="numberOfTimes">
                </kendo-numerictextbox>
            </td>
            <td>
                <kendo-numerictextbox class="max-w-numberric"
                    [min]="0" [format]="'n0'" formControlName="amountOfTimes">
                </kendo-numerictextbox>
            </td>
            <td>
                <kendo-numerictextbox class="max-w-numberric"
                    [min]="0" [format]="'n0'" formControlName="quantity">
                </kendo-numerictextbox>
            </td>
            <td>
                Viên
            </td>
            <td>
                <kendo-numerictextbox class="max-w-numberric"
                    [min]="0" [format]="'n0'" formControlName="numberOfDays">
                </kendo-numerictextbox>
            </td>
            <td>
                <select class="form-control" formControlName="useAt">
                    <option value="after_meal">Sau khi ăn</option>
                    <option value="before_meal">Trước khi ăn</option>
                    <option value="in_meal">Trong khi ăn</option>
                    <option value="after_wakeup">Sau khi thức dậy</option>
                    <option value="before_sleep">Trước khi đi ngủ</option>
                </select>
            </td>
            <td>
                <button type="button" title="Lưu" class="btn btn-success mr-1" (click)="saveLine(i)">
                    <i class="fas fa-check"></i>
                </button>
                <button type="button" title="Hủy" class="btn btn-danger" (click)="cancelLine(i)">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </td>
        </tr>
        <tr [formGroupName]="i" *ngIf="!getValueThuocArray(i, 'openInput')">
            <td>{{getValueThuocArray(i, 'product') ? getValueThuocArray(i, 'product').name : ''}}</td>
            <td>{{getValueThuocArray(i, 'numberOfTimes')}}</td>
            <td>{{getValueThuocArray(i, 'amountOfTimes')}}</td>
            <td>{{getValueThuocArray(i, 'quantity')}}</td>
            <td>Viên</td>
            <td>{{getValueThuocArray(i, 'numberOfDays')}}</td>
            <td>{{getUsedAt(getValueThuocArray(i, 'useAt'))}}</td>
            <td>
                <button type="button" title="Sửa" class="btn btn-light btn-sm mr-1" (click)="editLine(i)">
                    <span class="k-icon k-i-edit"></span>
                </button>
                <button type="button" title="Xóa" class="btn btn-light btn-sm" (click)="deleteLine(i)">
                    <span class="k-icon k-i-delete"></span>
                </button>
            </td>
        </tr>
    </tbody>
</table>