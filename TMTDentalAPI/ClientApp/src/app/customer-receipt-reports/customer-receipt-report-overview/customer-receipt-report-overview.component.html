<div class="flex-1-1-100 right border p-2 ml-2 d-flex flex-column w-100">
    <h5 class="flex-0-0-auto">Báo cáo tổng quan tiếp nhận</h5>
    <div class="filter d-flex flex-0-0-auto mt-2">
        <app-date-range-picker-filter [opens]="'right'" class="mr-1" [startDate]="dateFrom" [endDate]="dateTo"
            (searchChange)="onSearchDateChange($event)"></app-date-range-picker-filter>
        <kendo-combobox width="auto" class="kendo-combobox-sm" [placeholder]="'Tất cả chi nhánh'"
            class="mr-1 kendo-combobox-sm" [valueField]="'id'" [textField]="'name'" [filterable]="true"
            [data]="listCompany" (selectionChange)="onSelectCompany($event)" #companyCbx>
        </kendo-combobox>
        <button class="btn btn-secondary btn-sm mr-1" (click)="toggleShow()"><i class="fas fa-filter"></i> Lọc nâng cao
        </button>
        <button class="btn btn-primary btn-sm"><i class="fas fa-download"></i> Xuất file</button>
        <input type="text" [(ngModel)]="search" (ngModelChange)="this.searchUpdate.next($event)"
            placeholder="Tìm kiếm theo số phiếu, khách hàng" class="ml-auto form-control w-50 form-control-sm">
    </div>
    <div class="filter d-flex flex-0-0-auto mt-2" [ngClass]="{'toggled': isAdvanced == false}">
        <kendo-combobox class="mr-1 kendo-combobox-sm" [placeholder]="'Bác sĩ'" [valueField]="'id'" [textField]="'name'"
            [filterable]="true" #employeeCbx [data]="listEmployee" (selectionChange)="onSelectEmployee($event)">
        </kendo-combobox>
        <kendo-combobox (selectionChange)="onChangeExamination($event)" placeholder="Loại khám"
            class="kendo-combobox-sm mr-1" [data]="filterExamination" [textField]="'text'" [valueField]="'value'">
        </kendo-combobox>
        <kendo-combobox (selectionChange)="onChangeNotTreatment($event)" placeholder="Kết quả khám mới"
            class="kendo-combobox-sm mr-1" style="width: auto;" [data]="filterNoTreatment" [textField]="'text'"
            [valueField]="'value'">
        </kendo-combobox>
        <kendo-combobox (selectionChange)="onChangeState($event)" placeholder="Trạng thái" class="kendo-combobox-sm"
            style="width: auto;" [data]="filterState" [textField]="'text'" [valueField]="'value'">
        </kendo-combobox>
    </div>
    <div class="total d-flex mt-2">
        <div class="border mr-2 px-3 py-2 text-center">
            <h5 class="mb-0">Tiếp nhận</h5>
            <div class="text-primary">
                <h4>{{total}}</h4>
            </div>
        </div>
        <div class="border mr-2 px-3 py-2 text-center">
            <h5 class="mb-0">Loại khám</h5>
            <div class="d-flex">
                <div>
                    <ng-container *ngIf="pieDataExamination.length; else elseTemplate">
                        <kendo-chart class="size-chart">                    
                            <kendo-chart-series>
                                <kendo-chart-series-item type="pie" [data]="pieDataExamination" field="value"
                                    [name]="'category'" categoryField="category">
                                </kendo-chart-series-item>
                            </kendo-chart-series>
                            <kendo-chart-legend [visible]="false"></kendo-chart-legend>
                        </kendo-chart>
                    </ng-container>
                    <ng-template #elseTemplate>
                        <img src="./../../../assets/icons/NoData.svg" class="img-nodata"> 
                    </ng-template>
                </div>                     
            </div>
        </div>
        <div class="border mr-2 px-3 py-2 text-center">
            <h5 class="mb-0">Kết quả khám mới</h5>
            <div>
                <ng-container *ngIf="pieDataNoTreatment.length; else elseTemplate">
                    <kendo-chart>                       
                        <kendo-chart-series>
                            <kendo-chart-series-item type="pie" [data]="pieDataNoTreatment" field="value"
                                categoryField="category" [labels]="{ visible: true}">
                            </kendo-chart-series-item>
                        </kendo-chart-series>
                        <kendo-chart-legend [visible]="false"></kendo-chart-legend>
                    </kendo-chart>
                </ng-container>
                <ng-template #elseTemplate>
                    <img src="./../../../assets/icons/NoData.svg" class="img-nodata" >                  
                </ng-template>
            </div>
        </div>

    </div>
    <div class="o_content mt-2">
        <div class="o_dashboard_view">

            <div>
                <kendo-grid #grid (excelExport)="onExcelExport($event)" [data]="gridData" [pageSize]="limit"
                    [skip]="skip" [pageable]="true" [loading]="loading" (pageChange)="pageChange($event)">
                    <kendo-grid-column title="Ngày tiếp nhận" width="100">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{dataItem.dateWaiting | date:'shortDate'}}
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column title="Khách hàng" width="120">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{dataItem.partner?.name}}
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column title="Dịch vụ" width="120">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{dataItem.products}}
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column title="Bác sĩ" width="100">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{dataItem.doctorName}}
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column title="Giờ tiếp nhận" width="100">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{dataItem.dateWaiting | date: 'HH:mm'}}
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column title="Thời gian phục vụ" width="100">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{dataItem.minuteTotal}}
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column title="Loại khám" width="100">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{getExamination(dataItem.isRepeatCustomer)}}
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column title="Kết quả khám mới" width="100">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{dataItem.state != 'done' ? '' : getTreatment(dataItem.isNoTreatment)}}
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column title="Trạng thái" width="120">
                        <ng-template kendoGridCellTemplate let-dataItem>
                            {{getState(dataItem.state)}}
                        </ng-template>
                    </kendo-grid-column>
                    <!-- excel -->
                    <kendo-grid-excel fileName="BaoCaoCongNoKH.xlsx">
                        <kendo-excelexport-column field="partnerName" title="Khách hàng" width="200">
                        </kendo-excelexport-column>
                        <kendo-excelexport-column field="partnerRef" title="Mã KH" width="120">
                        </kendo-excelexport-column>
                        <kendo-excelexport-column field="partnerPhone" title="Số điện thoại" width="120">
                        </kendo-excelexport-column>
                        <kendo-excelexport-column field="begin" title="Nợ đầu kỳ" [cellOptions]="{format: '#,##0'}"
                            width="150">
                        </kendo-excelexport-column>
                        <kendo-excelexport-column field="debit" title="Phát sinh" [cellOptions]="{format: '#,##0'}"
                            width="150">
                        </kendo-excelexport-column>
                        <kendo-excelexport-column field="credit" title="Thanh toán" [cellOptions]="{format: '#,##0'}"
                            width="150">
                        </kendo-excelexport-column>
                        <kendo-excelexport-column field="end" title="Nợ cuối kỳ" [cellOptions]="{format: '#,##0'}"
                            width="150">
                        </kendo-excelexport-column>
                    </kendo-grid-excel>
                </kendo-grid>
            </div>
        </div>
    </div>

</div>