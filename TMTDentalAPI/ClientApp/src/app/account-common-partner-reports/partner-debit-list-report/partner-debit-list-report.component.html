<div class="o_cp_controller">
    <div class="o_control_panel">
        <ol class="breadcrumb">
            <li class="active">
                <span>Báo cáo công nợ khách hàng</span>
            </li>
        </ol>
        <div class="o_cp_searchview">
            <div class="o_searchview">
                <input class="o_searchview_input" [placeholder]="' Tìm kiếm theo tên khách hàng, số điện thoại'"
                    type="text" [(ngModel)]="search" (ngModelChange)="this.searchUpdate.next($event)">
            </div>
        </div>
        <div class="o_cp_left">
            <div class="o_cp_buttons">
                <button (click)="exportExcel(grid)" class="btn btn-sm btn-primary"><i
                        class="fas fa-download mr-1"></i>Xuất Excel</button>
            </div>
            <div class="o_cp_sidebar">
            </div>
        </div>
        <div class="o_cp_right">
            <!-- <app-tai-date-range-filter-dropdown class="mr-2" title="Thời gian" [dateFrom]="dateFrom" [dateTo]="dateTo"
                (searchChange)="searchChangeDate($event)">
            </app-tai-date-range-filter-dropdown> -->
            <app-date-range-picker-filter class="mr-1" (searchChange)="searchChangeDate($event)" [startDate]="dateFrom" [endDate]="dateTo">
            </app-date-range-picker-filter>
            <kendo-combobox [placeholder]="'Tất cả chi nhánh'" class="mr-1 kendo-combobox-sm" [valueField]="'id'"
                [textField]="'name'" [filterable]="true" [data]="companies" (selectionChange)="onSelectCompany($event)"
                #companyCbx>
            </kendo-combobox>
        </div>
    </div>
</div>

<div class="p-3 d-flex flex-row summary">
    <div class="p-3 mr-3 summary-col text-center d-flex flex-column mw-200" style="width: 150px">
        <label class="font-weight-600"> Nợ đầu kỳ </label>
        <h5 style="color: #2395FF;">{{sum('begin') | number }}</h5>
    </div>
    <div class="p-3 mr-3 summary-col text-center d-flex flex-column mw-200" style="width: 150px">
        <label class="font-weight-600"> Tiền phát sinh </label>
        <h5 style="color: #1A6DE3;">{{sum('debit') | number }}</h5>
    </div>
    <div class="p-3 mr-3 summary-col text-center d-flex flex-column mw-200" style="width: 150px">
        <label class="font-weight-600"> Tiền thanh toán </label>
        <h5 style="color: #28A745;">{{sum('credit') | number }}</h5>
    </div>
    <div class="p-3 mr-3 summary-col text-center d-flex flex-column mw-200" style="width: 150px">
        <label class="font-weight-600"> Nợ cuối kỳ </label>
        <h5 style="color: #EB3B5B;">{{sum('end') | number }}</h5>
    </div>
</div>

<div class="o_content px-3">
    <kendo-grid #grid (excelExport)="onExcelExport($event)" [data]="gridData" [pageSize]="limit" [skip]="skip"
        [pageable]="true" [loading]="loading" (pageChange)="pageChange($event)">
        <kendo-grid-column field="partnerName" [title]="resultSelection === 'supplier'?'Nhà cung cấp':'Khách hàng'">
            <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                <a class="text-primary" *ngIf="dataItem?.partnerId" [routerLink]="['/partners/customer/' + dataItem.partnerId]">
                    {{dataItem.partnerName}}
                </a>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="partnerRef" [title]="resultSelection === 'supplier'? 'Mã NCC':'Mã KH'">
        </kendo-grid-column>
        <kendo-grid-column field="partnerPhone" title="Số điện thoại">
        </kendo-grid-column>
        <kendo-grid-column field="begin" class="text-right" title="Nợ đầu kỳ">
            <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.begin | number}}
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="debit" class="text-right" title="Phát sinh">
            <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.debit | number}}
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="credit" class="text-right" title="Thanh toán">
            <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.credit | number}}
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="end" class="text-right" title="Nợ cuối kỳ" footerClass="text-right font-weight-bold">
            <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.end | number}}
            </ng-template>
        </kendo-grid-column>
        <!-- excel -->
        <kendo-grid-excel fileName="BaoCaoCongNoKH.xlsx" [fetchData]="allData"></kendo-grid-excel>
        <div *kendoGridDetailTemplate="let dataItem">
            <app-partner-debit-detail-list-report [parent]="dataItem"></app-partner-debit-detail-list-report>
        </div>
    </kendo-grid>
</div>