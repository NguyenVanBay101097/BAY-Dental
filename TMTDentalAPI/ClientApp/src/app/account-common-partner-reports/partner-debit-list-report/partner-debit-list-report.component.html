<div class="o_cp_controller">
    <div class="o_control_panel">
        <ol class="breadcrumb">
            <li class="active">
                <span>Báo cáo công nợ khách hàng</span>
            </li>
        </ol>
        <div class="o_cp_searchview">
            <div class="o_searchview">
                <span class="o_searchview_icon fa fa-search"></span>
                <input class="o_searchview_input" [placeholder]="' Tìm kiếm theo tên khách hàng, số điện thoại'" type="text" [(ngModel)]="search" (ngModelChange)="this.searchUpdate.next($event)">
            </div>
        </div>
        <div class="o_cp_left">
            <div class="o_cp_buttons">
                <button (click)="exportExcel(grid)" class="btn btn-primary btn-sm"><i
                        class="fas fa-download mr-1"></i>Xuất Excel</button>
            </div>
            <div class="o_cp_sidebar">
            </div>
        </div>
        <div class="o_cp_right">
            <app-date-range-picker-filter class="mr-1" (searchChange)="searchChangeDate($event)" [startDate]="dateFrom" [endDate]="dateTo">
            </app-date-range-picker-filter>
            <kendo-combobox [placeholder]="'Tất cả chi nhánh'" class="mr-1 kendo-combobox kendo-combobox-sm" [valueField]="'id'" [textField]="'name'" [filterable]="true" [data]="companies" (selectionChange)="onSelectCompany($event)" #companyCbx>
            </kendo-combobox>
        </div>
    </div>
</div>

<div class="o_content">
    <div class="o_dashboard_view">
        <div class="o_group">
            <div class="o_group o_group_col_12">
                <div class="o_aggregate_col o_group_col_3">
                    <div class="o_aggregate">
                        <label>Nợ đầu kỳ</label>
                        <div class="o_value text-info">{{sum('begin') | number }}</div>
                    </div>
                </div>
                <div class="o_aggregate_col o_group_col_3">
                    <div class="o_aggregate">
                        <label>Tiền phát sinh</label>
                        <div class="o_value text-primary">{{sum('debit') | number }}</div>
                    </div>
                </div>
                <div class="o_aggregate_col o_group_col_3">
                    <div class="o_aggregate">
                        <label>Tiền thanh toán</label>
                        <div class="o_value text-success">{{sum('credit') | number }}</div>
                    </div>
                </div>
                <div class="o_aggregate_col o_group_col_3">
                    <div class="o_aggregate text-danger">
                        <label>Nợ cuối kỳ</label>
                        <div class="o_value">{{sum('end') | number }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <kendo-grid #grid (excelExport)="onExcelExport($event)" [data]="gridData" [pageSize]="limit" [skip]="skip" [pageable]="true" [loading]="loading" (pageChange)="pageChange($event)">
                <kendo-grid-column field="partnerName" [title]="resultSelection === 'supplier'?'Nhà cung cấp':'Khách hàng'">
                </kendo-grid-column>
                <kendo-grid-column field="partnerRef" [title]="resultSelection === 'supplier'? 'Mã NCC':'Mã KH'">
                </kendo-grid-column>
                <kendo-grid-column field="partnerPhone" title="Số điện thoại">
                </kendo-grid-column>
                <kendo-grid-column field="begin" class="text-right" title="Nợ đầu kỳ">
                    <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                        {{dataItem.begin | number}}
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="debit" class="text-right" title="Phát sinh">
                    <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                        {{dataItem.debit | number}}
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="credit" class="text-right" title="Thanh toán">
                    <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                        {{dataItem.credit | number}}
                    </ng-template>
                </kendo-grid-column>
                <kendo-grid-column field="end" class="text-right" title="Nợ cuối kỳ" footerClass="text-right font-weight-bold">
                    <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                        {{dataItem.end | number}}
                    </ng-template>
                </kendo-grid-column>
                <!-- excel -->
                <kendo-grid-excel fileName="BaoCaoCongNoKH.xlsx" [fetchData]="allData"></kendo-grid-excel>
                <div *kendoGridDetailTemplate="let dataItem">
                    <app-partner-debit-detail-list-report [parent]="dataItem"></app-partner-debit-detail-list-report>
                </div>
            </kendo-grid>
        </div>
    </div>
</div>