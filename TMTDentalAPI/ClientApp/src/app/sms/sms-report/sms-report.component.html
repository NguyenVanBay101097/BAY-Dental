<div class="o_cp_controller">
    <div class="o_control_panel">
        <ol class="breadcrumb">
            <li class="active">Báo cáo SMS Brandname</li>
        </ol>
        <div class="o_cp_searchview">
        </div>
        <div class="o_cp_left">
            <div class="o_cp_buttons">
                <div class="o_form_buttons_view">
                </div>
            </div>
            <div class="o_cp_sidebar">
            </div>
        </div>
        <div class="o_cp_right">
        </div>
    </div>
</div>
<div class="o_content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-6 py-3">
                <div class="border">
                    <div class="bg-light border-bottom p-2 font-weight-bold">
                        Báo cáo tổng
                    </div>
                    <table class="table-report-total">
                        <tr>
                            <td class="table-title">
                                <span>Brandname</span>
                            </td>
                            <td>
                                <kendo-combobox class="w-100" [data]="filteredSmsBrandname"
                                    [(value)]="smsBrandname_reportTotal" [textField]="'brandName'" [valueField]="'id'"
                                    [filterable]="true" placeholder="Tất cả" #smsBrandnameCbx>
                                    <ng-template kendoComboBoxItemTemplate let-dataItem>
                                        <span>{{dataItem.brandName}} ({{dataItem.name}})</span>
                                    </ng-template>
                                </kendo-combobox>
                            </td>
                            <td class="table-title">
                                <span>Thời gian</span>
                            </td>
                            <td class="table-datepicker">
                                <kendo-datepicker class="w-100" [(value)]="date_reportTotal" [bottomView]="'year'"
                                    [format]="'MM yyyy'">
                                </kendo-datepicker>
                            </td>
                        </tr>
                        <tr>
                            <td class="table-title">
                                <span>Chiến dịch</span>
                            </td>
                            <td>
                                <kendo-combobox class="w-100" [data]="filteredSmsCampaign"
                                    [(value)]="smsCampaign_reportTotal" [textField]="'name'" [valueField]="'id'"
                                    [filterable]="true" placeholder="Tất cả" #smsCampaignCbx>
                                </kendo-combobox>
                            </td>
                            <td>
                                <button class="btn btn-primary btn-sm px-2" (click)="getReportTotal()">Báo cáo</button>
                            </td>
                            <td></td>
                        </tr>
                    </table>
                    <div>
                        <kendo-chart *ngIf="pieData_reportTotal.length" title="">
                            <kendo-chart-legend [visible]="false"></kendo-chart-legend>
                            <kendo-chart-series>
                                <kendo-chart-series-item [autoFit]="autofit" type="pie" [data]="pieData_reportTotal"
                                    field="total" categoryField="stateDisplay" colorField="color"
                                    [labels]="{ visible: true, content: labelContentReportTotal }">
                                </kendo-chart-series-item>
                            </kendo-chart-series>
                        </kendo-chart>
                        <div class="no-data-report" *ngIf="!pieData_reportTotal.length">
                            Không có dữ liệu
                        </div>
                        <div class="d-flex justify-content-around bg-white py-2">
                            <div class="legend-report-total legend-total">
                                <div class="color"></div>
                                <span>Tổng tin nhắn</span>
                                <div class="num">{{total_reportTotal}}</div>
                            </div>
                            <div class="legend-report-total legend-success">
                                <div class="color"></div>
                                <span>Gửi thành công</span>
                                <div class="num">{{success_reportTotal}}</div>
                            </div>
                            <div class="legend-report-total legend-fails">
                                <div class="color"></div>
                                <span>Gửi thất bại</span>
                                <div class="num">{{fails_reportTotal}}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 py-3">
                <div class="border">
                    <div class="bg-light border-bottom p-2 font-weight-bold">
                        Báo cáo theo nhà cung cấp
                    </div>
                    <div class="p-2">
                        <span class="mr-2">Nhà cung cấp</span>
                        <div class="form-group">
                            <select class="form-control" (change)="onChangeSupplier($event)"
                                id="exampleFormControlSelect1">
                                <option *ngFor="let item of filteredSmsSupplier" [value]="item.id">{{item.name}}
                                    ({{item.brandName}})
                                </option>
                            </select>
                        </div>
                    </div>
                    <kendo-chart *ngIf="(lineData_reportSupplierFails && lineData_reportSupplierFails.length > 0) 
                        || lineData_reportSupplierSuccess && lineData_reportSupplierSuccess.length > 0">
                        <kendo-chart-legend position="bottom" orientation="horizontal"></kendo-chart-legend>
                        <kendo-chart-tooltip format="{0}%"></kendo-chart-tooltip>
                        <kendo-chart-series>
                            <ng-container
                                *ngIf="lineData_reportSupplierSuccess && lineData_reportSupplierSuccess.length > 0">
                                <kendo-chart-series-item type="line" [style]="'smooth'" [dashType]="longDash"
                                    [data]="lineData_reportSupplierSuccess" field="count" categoryField="month"
                                    [name]="name">
                                    <kendo-chart-series-item-tooltip>
                                        <ng-template let-dataItem="dataItem">
                                            <span><b>Tổng tin nhắn: {{dataItem.total}}</b></span><br>
                                            <span><b>Gửi thành công: {{dataItem.count}}</b></span>
                                        </ng-template>
                                    </kendo-chart-series-item-tooltip>
                                </kendo-chart-series-item>
                            </ng-container>
                            <ng-container
                                *ngIf="lineData_reportSupplierFails && lineData_reportSupplierFails.length > 0">
                                <kendo-chart-series-item type="line" [style]="'smooth'" [dashType]="longDash"
                                    [data]="lineData_reportSupplierFails" field="count" categoryField="month"
                                    [name]="name">
                                    <kendo-chart-series-item-tooltip>
                                        <ng-template let-dataItem="dataItem">
                                            <span><b>Tổng tin nhắn: {{dataItem.total}}</b></span><br>
                                            <span><b>Gửi thất bại: {{dataItem.count}}</b></span>
                                        </ng-template>
                                    </kendo-chart-series-item-tooltip>
                                </kendo-chart-series-item>
                            </ng-container>
                        </kendo-chart-series>
                    </kendo-chart>
                    <div class="no-data-report" *ngIf="!lineData_reportSupplierSuccess || 
                        !lineData_reportSupplierSuccess.length || 
                        !lineData_reportSupplierFails || 
                        !lineData_reportSupplierFails.length">
                        Không có dữ liệu
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="px-3">
        <div class="d-flex justify-content-between mb-2">
            <app-tai-date-range-filter-dropdown title="Thời gian" [dateFrom]="dateFromReportCampaign"
                [dateTo]="dateToReportCampaign" (searchChange)="dateChangeReportCampaign($event)">
            </app-tai-date-range-filter-dropdown>
            <input class="form-control form-control-sm w-50" type="text" placeholder="Tìm kiếm theo tên chiến dịch"
                [(ngModel)]="searchReportCampaign" (ngModelChange)="this.searchUpdateReportCampaign.next($event)" />
        </div>
        <kendo-grid [data]="gridDataReportCampaign" [pageSize]="limitReportCampaign" [skip]="offsetReportCampaign"
            [pageable]="true" [loading]="loadingReportCampaign" (pageChange)="pageChangeReportTotal($event)">
            <kendo-grid-column field="smsCampaignName" title="Chiến dịch"></kendo-grid-column>
            <kendo-grid-column field="totalMessages" title="Tổng tin nhắn"></kendo-grid-column>
            <kendo-grid-column field="totalSuccessfulMessages" title="Thành công"></kendo-grid-column>
            <kendo-grid-column field="totalFailedMessages" title="Thất bại"></kendo-grid-column>
        </kendo-grid>
    </div>
</div>