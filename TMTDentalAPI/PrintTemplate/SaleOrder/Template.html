<table border="0" cellpadding="5" cellspacing="0" style="width:100%">
    <tbody>
        <tr>
            <td style="width:100px"><img alt="{{o.company.name}}" class="img-fluid" src="{{o.company.logo ?? '/assets/images/placeholder.png'}}" style="width:150px" /></td>
            <td>
                <strong>{{o.company.name}}</strong><br />
                Địa chỉ: {{o.company.address}}<br />
                ĐT: {{o.company.phone}}<br />
                Email: {{o.company.email}}
            </td>
        </tr>
    </tbody>
</table>

<h3 style="text-align:center">PHIẾU ĐIỀU TRỊ</h3>

<p style="text-align: center;">
    Ngày {{o.date_order.day}} tháng {{o.date_order.month}} năm {{o.date_order.year}}<br />
    <strong>Số: {{o.name}}</strong>
</p>

<h6>THÔNG TIN KHÁCH HÀNG</h6>

<table border="0" cellpadding="3" cellspacing="1" style="width:100%">
    <tbody>
        <tr>
            <td style="width:120px"><strong>Khách hàng</strong></td>
            <td>{{o.partner?.name}}</td>
            <td style="width:120px"><strong>Giới tính</strong></td>
            <td>{{o.partner?.get_gender}}</td>
        </tr>
        <tr>
            <td style="width:120px"><strong>Ngày sinh</strong></td>
            <td>{{o.partner?.get_birth_day}}</td>
            <td style="width:120px"><strong>Điện thoại</strong></td>
            <td>{{o.partner?.phone}}</td>
        </tr>
        <tr>
            <td style="width:120px"><strong>Địa chỉ</strong></td>
            <td>{{o.partner?.address}}</td>
        </tr>
    </tbody>
</table>
<!--{{if (o.partner.history_list > 0 || o.partner.medical_history)}}-->
<h6>TIỂU SỬ BỆNH</h6>
<!--{{for history in o.partner.history_list}}-->
- {{history}}
<br />
<!--{{end}}-->
<p><strong>Tiểu sử bệnh khác: </strong>{{o.partner.medical_history ? o.partner.medical_history : ""}}</p>
<!--{{end}}-->
<!--{{if (o.have_adult_teeth || o.have_child_teeth)}}-->
<h6>SƠ ĐỒ RĂNG</h6>
<div class="text-center">
    {{if (o.have_adult_teeth)}}
    <div class="teeth_container">
        <div class="ham_tren">
            <div class="teethElement flex-row-reverse">
                <!--{{for teeth in o.adult_up_right_teeth}}-->
                {{if (teeth.is_selected)}} <div class="teeth_nameTeeth selected">{{teeth.name}}</div> {{end}}
                {{if (!teeth.is_selected)}} <div class="teeth_nameTeeth">{{teeth.name}}</div> {{end}}
                <!--{{end}}-->
            </div>
            <div class="chia_doi_doc"></div>
            <div class="teethElement">
                <!--{{for teeth in o.adult_up_left_teeth}}-->
                {{if (teeth.is_selected)}} <div class="teeth_nameTeeth selected">{{teeth.name}}</div> {{end}}
                {{if (!teeth.is_selected)}} <div class="teeth_nameTeeth">{{teeth.name}}</div> {{end}}
                <!--{{end}}-->
            </div>
        </div>
        <div class="duong_chia_doi"></div>
        <div class="ham_duoi">
            <div class="teethElement flex-row-reverse">
                <!--{{for teeth in o.adult_down_right_teeth}}-->
                {{if (teeth.is_selected)}} <div class="teeth_nameTeeth selected">{{teeth.name}}</div>{{end}}
                {{if (!teeth.is_selected)}} <div class="teeth_nameTeeth">{{teeth.name}}</div> {{end}}
                <!--{{end}}-->
            </div>
            <div class="chia_doi_doc"></div>
            <div class="teethElement">
                <!--{{for teeth in o.adult_down_left_teeth}}-->
                {{if (teeth.is_selected)}} <div class="teeth_nameTeeth selected">{{teeth.name}}</div> {{end}}
                {{if (!teeth.is_selected)}} <div class="teeth_nameTeeth">{{teeth.name}}</div> {{end}}
                <!--{{end}}-->
            </div>
        </div>
    </div>

    {{end}}
    {{if (o.have_child_teeth)}}
    <div class="teeth_container mt-1">
        <div class="ham_tren">
            <div class="teethElement flex-row-reverse">
                <!--{{for teeth in o.child_up_right_teeth}}-->
                {{if (teeth.is_selected)}} <div class="teeth_nameTeeth selected">{{teeth.name}}</div> {{end}}
                {{if (!teeth.is_selected)}} <div class="teeth_nameTeeth">{{teeth.name}}</div> {{end}}
                <!--{{end}}-->
            </div>
            <div class="chia_doi_doc"></div>
            <div class="teethElement">
                <!--{{for teeth in o.child_up_left_teeth}}-->
                {{if (teeth.is_selected)}} <div class="teeth_nameTeeth selected">{{teeth.name}}</div> {{end}}
                {{if (!teeth.is_selected)}} <div class="teeth_nameTeeth">{{teeth.name}}</div> {{end}}
                <!--{{end}}-->
            </div>
        </div>
        <div class="duong_chia_doi"></div>
        <div class="ham_duoi">
            <div class="teethElement flex-row-reverse">
                <!--{{for teeth in o.child_down_right_teeth}}-->
                {{if (teeth.is_selected)}} <div class="teeth_nameTeeth selected">{{teeth.name}}</div>{{end}}
                {{if (!teeth.is_selected)}} <div class="teeth_nameTeeth">{{teeth.name}}</div> {{end}}
                <!--{{end}}-->
            </div>
            <div class="chia_doi_doc"></div>
            <div class="teethElement">
                <!--{{for teeth in o.child_down_left_teeth}}-->
                {{if (teeth.is_selected)}} <div class="teeth_nameTeeth selected">{{teeth.name}}</div> {{end}}
                {{if (!teeth.is_selected)}} <div class="teeth_nameTeeth">{{teeth.name}}</div> {{end}}
                <!--{{end}}-->
            </div>
        </div>
    </div>
    {{end}}
</div>
<!--{{end}}-->
<div style="display: inline-block">
    <div style="display: flex">
        <div>

        </div>
        <div></div>
        <div>
            <div></div>
        </div>
    </div>
</div>
<h6>DANH SÁCH DỊCH VỤ</h6>
<table border="1" cellpadding="3" cellspacing="1" style="width:100%">
    <tbody>
        <tr>
            <td><strong>Dịch vụ</strong></td>
            <td><strong>Răng</strong></td>
            <td><strong>ĐVT</strong></td>
            <td style="text-align:right"><strong>Số lượng</strong></td>
            <td style="text-align:right"><strong>Đơn giá</strong></td>
            <td style="text-align:right"><strong>Giảm giá</strong></td>
            <td style="text-align:right"><strong>Thành tiền</strong></td>
        </tr>
        <!--{{for line in o.order_lines}}-->
        <tr>
            <td><strong>{{line.product?.name}}</strong><br />Chẩn đoán: {{line.diagnostic ? line.diagnostic : ""}}</td>
            <td>{{line.teeth_display ? line.teeth_display : ""}}</td>
            <td>{{line.product_uom?.name}}</td>
            <td style="text-align:right">{{(line.product_uomqty ? line.product_uomqty : 0) | math.format "N0" }}</td>
            <td style="text-align:right">{{line.price_unit | math.format "N0" }}</td>
            <td style="text-align:right">{{line.amount_discount_total | math.format "N0" }}</td>
            <td style="text-align:right">{{line.price_sub_total | math.format "N0" }}</td>
        </tr>
        <!--{{end}}-->
    </tbody>
</table>

<table align="right" cellpadding="3" border="0" cellspacing="1">
    <tbody>
        <tr>
            <td style="width:120px"><strong>Tổng tiền</strong></td>
            <td style="text-align:right">{{o.amount_total | math.format "N0" }}</td>
        </tr>
        <tr>
            <td style="width:120px"><strong>Đã thanh toán</strong></td>
            <td style="text-align:right">{{o.total_paid | math.format "N0"}}</td>
        </tr>
        <tr>
            <td style="width:120px"><strong>Còn lại</strong></td>
            <td style="text-align:right">{{o.residual | math.format "N0" }}</td>
        </tr>
    </tbody>
</table>

<div class="clearfix"></div>
<!--{{if (o.sale_order_payments.size > 0)}}-->
<h6>LỊCH SỬ THANH TOÁN</h6>

<table border="1" cellpadding="3" cellspacing="1" style="width:100%">
    <tbody>
        <tr>
            <td style="width:120px"><strong>Mã thanh toán</strong></td>
            <td style="width:120px"><strong>Ngày thanh toán</strong></td>
            <td style="width:200px"><strong>Dịch vụ</strong></td>
            <td style="text-align:right;width:120px;"><strong>Số tiền</strong></td>
            <td style="width:120px"><strong>Phương thức</strong></td>
            <td style="text-align:right;width:120px"><strong>Thanh toán</strong></td>
        </tr>
        <!--{{for sop in o.sale_order_payments}}-->
        <!--{{for item in sop.payment_rels}}-->
        <tr>
            <td>{{item.payment?.name}}</td>
            <!--{{if item.payment?.id == sop.payment_rels[0]?.payment.id}}-->
            <td rowspan="{{sop.payment_rels | array.size}}">{{item.payment?.payment_date | date.to_string '%d/%m/%Y'}}</td>
            <td rowspan="{{sop.payment_rels | array.size}}">{{sop.lines_display}}</td>
            <td rowspan="{{sop.payment_rels | array.size}}" style="text-align:right">{{sop.amount | math.format "N0" }}</td>
            <!--{{end}}-->
            <td>{{item.payment?.journal?.name}}</td>
            <td style="text-align:right">{{item.payment?.amount | math.format "N0"}}</td>
        </tr>

        <!--{{end}}-->
        <!--{{end}}-->
    </tbody>
</table>
<!--{{end}}-->
<!--{{if (o.dot_khams.size > 0)}}-->
<h6>DANH SÁCH ĐỢT KHÁM</h6>
<!--{{for dotkham in o.dot_khams}}-->
<!--{{i = for.index + 1}}-->
<strong>Đợt khám {{i}} - Ngày {{dotkham.date | date.to_string '%d/%m/%Y' }} - BS.{{dotkham.doctor ? dotkham.doctor?.name : ""}}</strong>
<table border="1" cellpadding="3" cellspacing="1" style="width:100%">
    <tbody>
        <tr>
            <!--<td><strong>Đợt khám</strong></td>-->
            <!--<td><strong>Ngày</strong></td>-->
            <!--<td><strong>Bác sĩ</strong></td>-->
            <!--<td><strong>Mô tả</strong></td>-->
            <td><strong>Dịch vụ</strong></td>
            <td><strong>Công đoạn</strong></td>
            <td><strong>Răng, Chi tiết điều trị</strong></td>
        </tr>


        <!--{{for line in dotkham.lines}}-->
        <tr>
            <td style="vertical-align:top">{{line.product.name}}</td>
            <td style="vertical-align:top">{{line.name_step}}</td>
            <td style="vertical-align:top">
                {{line.teeth_display}}
                <p>{{line.note}}</p>
            </td>
        </tr>

        <!--{{end}}-->
    </tbody>
</table>
<!--{{end}}-->
<!--{{end}}-->
<!--{{if (o.ir_attachments.size > 0)}}-->
<h6>PHIM XQKTS</h6>

<p><!--{{for ir in o.ir_attachments}}--><img alt="{{ir.name}}" class="img-fluid" src="{{ir.url}}?width=240&height=240)" style="width:150px" /> <!--{{end}}--></p>

<!--{{end}}-->
<table border="0" cellpadding="0" cellspacing="1" style="width:100%">
    <tbody>
        <tr>
            <td style="text-align:center;width:50%;">
                <strong>Người lập phiếu</strong><br />
                <em>(Ký, họ tên)</em><br />
                </>
                <br />
                <br />
                <br />


                <br />


                <strong>{{u.name | string.upcase}}</strong>
            </td>
            <td style="text-align:center;width: 50%;">
                <strong>Khách hàng</strong><br />
                <em>(Ký, họ tên)</em><br />
                <br />
                <br />
                <br />
                <br />
                <strong>{{o.partner?.name | string.upcase}}</strong>
            </td>
        </tr>
    </tbody>
</table>